        
<!DOCTYPE html>
<!--[if IE 8]>
<html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head><base href="../">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
                                
    
    <link rel="stylesheet" href="assets/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="assets/css/badge_only.css" type="text/css" />

</head>

<body class="wy-body-for-nav">
 <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
            <div class="wy-side-nav-search">
                
                                                                                                    
                                                                                                                                                                        </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                                                                                                                                                                                                                                                                                                                            </div>
        </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                                                        

        <div class="wy-nav-content">                <div class="rst-content">
                                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">                            <div itemprop="articleBody">
                                    <div class="section">
<h1 id="how-to-create-your-custom-normalizer">
    How to Create your Custom Normalizer
    <a class="headerlink" href="#how-to-create-your-custom-normalizer" title="Permalink to this headline">¶</a>
</h1>
<p>The <a href="../serializer.html" class="reference internal">Serializer component</a> uses normalizers to transform
any data into an array. The component provides several
ref:`built-in normalizers &lt;serializer-built-in-normalizers&gt;` but you may
need to create your own normalizer to transform an unsupported data
structure.</p>
<div class="section">
<h2 id="creating-a-new-normalizer">
    Creating a New Normalizer
    <a class="headerlink" href="#creating-a-new-normalizer" title="Permalink to this headline">¶</a>
</h2>
<p>Imagine you want add, modify, or remove some properties during the serialization
process. For that you'll have to create your own normalizer. But it's usually
preferable to let Symfony normalize the object, then hook into the normalization
to customize the normalized data. To do that, leverage the <code translate="no" class="notranslate">ObjectNormalizer</code>:</p>
<div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// src/Serializer/TopicNormalizer.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Serializer</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Entity</span>\<span class="hljs-title">Topic</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Routing</span>\<span class="hljs-title">Generator</span>\<span class="hljs-title">UrlGeneratorInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Serializer</span>\<span class="hljs-title">Normalizer</span>\<span class="hljs-title">ContextAwareNormalizerInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Serializer</span>\<span class="hljs-title">Normalizer</span>\<span class="hljs-title">ObjectNormalizer</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TopicNormalizer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ContextAwareNormalizerInterface</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>router</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>normalizer</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(UrlGeneratorInterface <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>router</span>, ObjectNormalizer <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>normalizer</span>)</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span>-&gt;router = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>router</span>;
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span>-&gt;normalizer = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>normalizer</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">normalize</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>topic</span>, ?<span class="hljs-keyword">string</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>format</span> = <span class="hljs-keyword">null</span>, <span class="hljs-keyword">array</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>context</span> = [])</span>
    </span>{
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span> = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span>-&gt;normalizer-&gt;<span class="hljs-title invoke__">normalize</span>(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>topic</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>format</span>, <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>context</span>);

        <span class="hljs-comment">// Here, add, edit, or delete some data:</span>
        <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span>[<span class="hljs-string">'href'</span>][<span class="hljs-string">'self'</span>] = <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>this</span>-&gt;router-&gt;<span class="hljs-title invoke__">generate</span>(<span class="hljs-string">'topic_show'</span>, [
            <span class="hljs-string">'id'</span> =&gt; <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>topic</span>-&gt;<span class="hljs-title invoke__">getId</span>(),
        ], UrlGeneratorInterface::<span class="hljs-variable constant_">ABSOLUTE_URL</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">supportsNormalization</span><span class="hljs-params">(<span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span>, ?<span class="hljs-keyword">string</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>format</span> = <span class="hljs-keyword">null</span>, <span class="hljs-keyword">array</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>context</span> = [])</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>data</span> <span class="hljs-keyword">instanceof</span> Topic;
    }
}</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section">
<h2 id="registering-it-in-your-application">
    Registering it in your Application
    <a class="headerlink" href="#registering-it-in-your-application" title="Permalink to this headline">¶</a>
</h2>
<p>Before using this normalizer in a Symfony application it must be registered as
a service and <a href="../service_container/tags.html" class="reference internal">tagged</a> with <code translate="no" class="notranslate">serializer.normalizer</code>.
If you're using the <a href="../service_container.html#service-container-services-load-example" class="reference internal">default services.yaml configuration</a>,
this is done automatically!</p>
<p>If you're not using <code translate="no" class="notranslate">autoconfigure</code>, you have to tag the service with
<code translate="no" class="notranslate">serializer.normalizer</code>. You can also use this method to set a priority
(higher means it's called earlier in the process):</p>
<div class="configuration-block">
    <div role="tablist" aria-label="Configuration formats" class="configuration-tabs configuration-tabs-length-3">
                    <button role="tab" type="button" data-language="yaml"
                aria-controls="configuration-block-tabpanel-7269b51f0f0eb91d184f8267ab90d8336ea49603" aria-selected="true"
                data-active="true" >
                <span>YAML</span>
            </button>
                    <button role="tab" type="button" data-language="xml"
                aria-controls="configuration-block-tabpanel-5f75c6ccd53d4271376b652828f0f91c63280529" aria-selected="false"
                 tabindex="-1">
                <span>XML</span>
            </button>
                    <button role="tab" type="button" data-language="php"
                aria-controls="configuration-block-tabpanel-257d85b0b2100dd16211ea377e6dccafd0061975" aria-selected="false"
                 tabindex="-1">
                <span>PHP</span>
            </button>
            </div>

            <div role="tabpanel" id="configuration-block-tabpanel-7269b51f0f0eb91d184f8267ab90d8336ea49603" aria-label="YAML" class="configuration-codeblock" data-language="yaml" style="">
            <div translate="no" class="highlight-yaml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs yaml"><span class="hljs-comment"># config/services.yaml</span>
<span class="hljs-attr">services:</span>
    <span class="hljs-comment"># ...</span>

    <span class="hljs-string">App\Serializer\TopicNormalizer:</span>
        <span class="hljs-attr">tags:</span>
            <span class="hljs-comment"># register the normalizer with a high priority (called earlier)</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">{</span> <span class="hljs-attr">name:</span> <span class="hljs-string">'serializer.normalizer'</span><span class="hljs-string">,</span> <span class="hljs-attr">priority:</span> <span class="hljs-number">500</span> <span class="hljs-string">}</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-5f75c6ccd53d4271376b652828f0f91c63280529" aria-label="XML" class="configuration-codeblock" data-language="xml" style="display: none">
            <div translate="no" class="highlight-xml notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs xml"><span class="hljs-comment">&lt;!-- config/services.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">container</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://symfony.com/schema/dic/services
        https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">services</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- ... --&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"App\Serializer\TopicNormalizer"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- register the normalizer with a high priority (called earlier) --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"serializer.normalizer"</span>
                <span class="hljs-attr">priority</span>=<span class="hljs-string">"500"</span>
            /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">services</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span></pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
            <div role="tabpanel" id="configuration-block-tabpanel-257d85b0b2100dd16211ea377e6dccafd0061975" aria-label="PHP" class="configuration-codeblock" data-language="php" style="display: none">
            <div translate="no" class="highlight-php notranslate">
    <table class="highlighttable">
        <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
                        <pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre>
                    </div>
                </td>
                <td class="code">
                    <div class="highlight">
                        <pre class="hljs php"><span class="hljs-comment">// config/services.php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">DependencyInjection</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Serializer</span>\<span class="hljs-title">TopicNormalizer</span>;

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ContainerConfigurator <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>container</span>)</span> </span>{
    <span class="hljs-comment">// ...</span>

    <span class="hljs-comment">// if you're using autoconfigure, the tag will be automatically applied</span>
    <span class="hljs-variable"><span class="hljs-variable-other-marker">$</span>services</span>-&gt;<span class="hljs-title invoke__">set</span>(TopicNormalizer::<span class="hljs-variable language_">class</span>)
        <span class="hljs-comment">// register the normalizer with a high priority (called earlier)</span>
        -&gt;<span class="hljs-title invoke__">tag</span>(<span class="hljs-string">'serializer.normalizer'</span>, [
            <span class="hljs-string">'priority'</span> =&gt; <span class="hljs-number">500</span>,
        ])
    ;
};</pre>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        </div>
    </div>
</div>
<div class="section">
<h2 id="performance">
    Performance
    <a class="headerlink" href="#performance" title="Permalink to this headline">¶</a>
</h2>
<p>To figure which normalizer (or denormalizer) must be used to handle an object,
the <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Serializer/Serializer.php" class="reference external" title="Symfony\Component\Serializer\Serializer" rel="external noopener noreferrer" target="_blank">Serializer</a> class will call the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Serializer/Normalizer/NormalizerInterface.php#:~:text=function%20supportsNormalization" class="reference external" title="Symfony\Component\Serializer\Normalizer\NormalizerInterface::supportsNormalization()" rel="external noopener noreferrer" target="_blank">supportsNormalization()</a>
(or <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Serializer/Normalizer/DenormalizerInterface.php#:~:text=function%20supportsDenormalization" class="reference external" title="Symfony\Component\Serializer\Normalizer\DenormalizerInterface::supportsDenormalization()" rel="external noopener noreferrer" target="_blank">supportsDenormalization()</a>)
of all registered normalizers (or denormalizers) in a loop.</p>
<p>The result of these methods can vary depending on the object to serialize, the
format and the context. That's why the result <strong>is not cached</strong> by default and
can result in a significant performance bottleneck.</p>
<p>However, most normalizers (and denormalizers) always return the same result when
the object's type and the format are the same, so the result can be cached. To
do so, make those normalizers (and denormalizers) implement the
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Serializer/Normalizer/CacheableSupportsMethodInterface.php" class="reference external" title="Symfony\Component\Serializer\Normalizer\CacheableSupportsMethodInterface" rel="external noopener noreferrer" target="_blank">CacheableSupportsMethodInterface</a>
and return <code translate="no" class="notranslate">true</code> when
<a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Serializer/Normalizer/CacheableSupportsMethodInterface.php#:~:text=function%20hasCacheableSupportsMethod" class="reference external" title="Symfony\Component\Serializer\Normalizer\CacheableSupportsMethodInterface::hasCacheableSupportsMethod()" rel="external noopener noreferrer" target="_blank">hasCacheableSupportsMethod()</a>
is called.</p>
<div class="admonition admonition-note ">
    <p class="admonition-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                <span>Note</span>
    </p><p>All built-in <a href="../serializer.html#serializer-built-in-normalizers" class="reference internal">normalizers and denormalizers</a>
as well the ones included in <a href="https://api-platform.com" class="reference external" rel="external noopener noreferrer" target="_blank">API Platform</a> natively implement this interface.</p>
</div>
</div>
</div>

                            </div>                    </div>
                                    </div>        </div>

    </section>

</div>


<script type="text/javascript" src="assets/js/theme.js"></script>
<script type="text/javascript" src="assets/js/badge_only.js"></script>

 
</body>
</html>